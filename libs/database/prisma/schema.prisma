// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String          @id @default(uuid())
  name          String
  email         String          @unique
  password_hash String
  push_token    String?
  email_enabled Boolean         @default(true)
  push_enabled  Boolean         @default(true)
  created_at    DateTime        @default(now())
  updated_at    DateTime        @updatedAt
  notifications Notification[]
  
  @@map("users")
}

model Template {
  id          String       @id @default(uuid())
  code        String       @unique
  name        String
  type        TemplateType
  subject     String
  content     String       @db.Text
  variables   Json?
  version     Int          @default(1)
  is_active   Boolean      @default(true)
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt
  
  @@map("templates")
}

enum TemplateType {
  EMAIL
  PUSH
}

model Notification {
  id                 String             @id @default(uuid())
  user_id            String
  notification_type  NotificationType
  template_code      String
  variables          Json
  priority           Int
  request_id         String             @unique
  status             NotificationStatus @default(PENDING)
  metadata           Json?
  retry_count        Int                @default(0)
  error_message      String?
  provider_response  Json?
  sent_at            DateTime?
  delivered_at       DateTime?
  failed_at          DateTime?
  created_at         DateTime           @default(now())
  updated_at         DateTime           @updatedAt
  
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@index([user_id])
  @@index([status])
  @@index([notification_type])
  @@index([request_id])
  @@index([created_at])
  @@map("notifications")
}

enum NotificationType {
  EMAIL
  PUSH
}

enum NotificationStatus {
  PENDING
  DELIVERED
  FAILED
}

model NotificationLog {
  id              String   @id @default(uuid())
  notification_id String
  event           String
  details         Json?
  timestamp       DateTime @default(now())
  
  @@index([notification_id])
  @@map("notification_logs")
}